---
// Get localStorage themeVars string, and set it as the CSS variables
---
<script is:inline>
  const themeCss = localStorage.getItem('xypnoxCssTheme');
  let style = document.getElementById('_themeVars');

  if (style && themeCss) {
    const themeString = JSON.parse(themeCss);
    if (themeString) style.innerHTML = `:root { ${themeString} }`;
  } 

  const themes = localStorage.getItem('xypnox-themes');
  const themeConfig = localStorage.getItem('xypnox-themeConfig');

  if (themes && themeConfig) {
    const themesPalette = JSON.parse(themes);
    const themeConfigPalette = JSON.parse(themeConfig);
    // find theme from config in palettes
    const theme = themesPalette.find((theme) => theme.id === themeConfigPalette.theme);
    const fontFamily = theme.base.font.family;
    console.log({ theme, fontFamily });

    const getFirstFont = (style/* string */) => {
      const font = style.split(',')[0];
      return font.replace(/"/g, '');
    }
    const link = document.createElement('link');
    link.href = `https://fonts.googleapis.com/css2?family=${getFirstFont(fontFamily)}:ital,wght@0,400;0,500;0,600;1,400;1,500;1,600&display=swap`;
    link.rel = 'stylesheet';
    link.id = '_fontFamily';
    document.head.appendChild(link);
  }
</script>

